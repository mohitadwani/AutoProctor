<html>

<head>
    <style>
    .camera-video {
        /*top: 10%;*/
        /*left: 25%;*/
        position: absolute;
        z-index:999999;
    }
    </style>
    <script src="../js/headtrackr/headtrackr.js"></script>
    <script src="../bower_components/tracking.js/build/tracking-min.js" type="text/javascript"></script>
    <script src="../bower_components/tracking.js/build/data/face-min.js" type="text/javascript"></script>
</head>

<body>
    <video id="inputVideo" autoplay loop width="320" height="240" style="position: absolute;"></video>
    <canvas id="headtracker_canvas" width="320" height="240" style="position: absolute;"></canvas>
    <canvas class="camera-video" id="tracking_canvas" width="320" height="240"></canvas>
    <script type="text/javascript">
    var videoInput = document.getElementById('inputVideo');
    console.log(document.getElementById('headtracker_canvas'))
    var canvasInput = document.getElementById('headtracker_canvas');
    var headCanvas = canvasInput.getContext('2d');
    canvasInput.style.position = "absolute";
    canvasInput.style.top = '0px';
    canvasInput.style.zIndex = '100001';
    canvasInput.style.display = 'block';

    var canvas = document.getElementById('tracking_canvas'); //to draw the face rect
    var context = canvas.getContext('2d');

    var htracker = new headtrackr.Tracker();
    htracker.init(videoInput, canvasInput);
    htracker.start();

    document.addEventListener("facetrackingEvent", function(event) {
        // clear canvas
        // once we have stable tracking, draw rectangle
        if (event.detection == "CS") {
            headCanvas.translate(event.x, event.y)
            headCanvas.rotate(event.angle - (Math.PI / 2));
            headCanvas.strokeStyle = "#00CC00";
            headCanvas.strokeRect((-(event.width / 2)) >> 0, (-(event.height / 2)) >> 0, event.width, event.height);
            headCanvas.rotate((Math.PI / 2) - event.angle);
            headCanvas.translate(-event.x, -event.y);
        }
    });

    var trackedObjects = new tracking.ObjectTracker('face');

    var objectOnTrack = objectOnTrack;

    trackedObjects.on('track', objectOnTrack);
    trackedObjects.setInitialScale(1);
    trackedObjects.setStepSize(2);
    trackedObjects.setEdgesDensity(0.1);

    function objectOnTrack(event) {
    	console.log("here")
        context.clearRect(0, 0, canvas.width, canvas.height);
        if (event.data.length === 0) {
            console.log('Not Detected');
        } else {
            // console.log(event.data);
            event.data.forEach(function(rect) {
                context.strokeStyle = '#a64ceb';
                context.strokeRect(rect.x, rect.y, rect.width, rect.height);
                context.font = '11px Helvetica';
                context.fillStyle = "#fff";
                context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
                context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);
            });
        }
    }
    tracking.track('#inputVideo', trackedObjects);
    </script>
</body>

</html>
